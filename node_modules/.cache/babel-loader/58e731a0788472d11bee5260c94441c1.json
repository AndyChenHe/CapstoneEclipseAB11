{"ast":null,"code":"var _jsxFileName = \"/Users/Michelle/Desktop/Capstone/CapstoneEclipseAB11/src/Components/profile/HospTags.js\";\nimport React, { Fragment, useEffect } from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport Dialog from \"@material-ui/core/Dialog\";\nimport Chip from \"@material-ui/core/Chip\";\nimport Button from \"@material-ui/core/Button\";\nimport Box from \"@material-ui/core/Box\";\nimport Typography from \"@material-ui/core/Typography\";\nimport DialogActions from \"@material-ui/core/DialogActions\";\nimport Hidden from \"@material-ui/core/Hidden\";\nimport Divider from \"@material-ui/core/Divider\";\nimport EditOutlinedIcon from \"@material-ui/icons/EditOutlined\";\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport { connect } from \"react-redux\";\nimport PropTypes from \"prop-types\";\nimport axios from \"axios\";\nimport { updateUserStoredHospTags } from \"../../redux/actions/userActions\";\nimport { updateHospTags } from \"../../redux/actions/dataActions\";\nconst proxyurl = \"https://cors-anywhere.herokuapp.com/\"; // ～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～\n// ～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～\n// \"hospital tags\" used in this js is actually referred to the tags attached to a specialty in this hospital\n// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nconst useStyles = makeStyles(theme => ({\n  editTagDialog: {\n    display: \"flex\",\n    justifyContent: \"center\",\n    flexWrap: \"wrap\",\n    listStyle: \"none\",\n    padding: theme.spacing(0.5),\n    margin: 0\n  },\n  tag: {\n    margin: theme.spacing(0.5)\n  },\n  tagDialog: {\n    display: \"flex\",\n    flexWrap: \"wrap\",\n    listStyle: \"none\",\n    padding: theme.spacing(0.5),\n    margin: 0,\n    [theme.breakpoints.down(\"xs\")]: {\n      marginLeft: 10\n    },\n    marginBottom: 20\n  },\n  editTagsButton: {\n    [theme.breakpoints.down(\"xs\")]: {\n      marginLeft: 20\n    }\n  },\n  line: {\n    [theme.breakpoints.down(\"xs\")]: {\n      border: \"5px solid rgba(0, 0, 0, 0.05)\"\n    }\n  },\n  reviewTagsBox: {\n    [theme.breakpoints.down(\"xs\")]: {\n      justifyContent: \"left\",\n      alignItems: \"left\",\n      marginLeft: 20\n    }\n  },\n  divider: {\n    height: 2,\n    width: 115,\n    backgroundColor: \"#FF8686\"\n  }\n})); // Edit Hospital Tags (用在HospInfo.js)\n// 目前hospital所有的tags and edit tags 都是hardcoded， 麻烦你了\n\nfunction HospTags(props) {\n  const classes = useStyles();\n  const authenticated = props.authenticated;\n  const [allTags, setState] = React.useState({\n    currentTags: [],\n    storedUserTags: []\n  });\n  const [renderCount, setRenderCount] = React.useState(0); // only call useEffect if renderCount = 0 (will be updated to 1 if stored data\n  // in firebase is successfully set to state)\n\n  useEffect(() => {\n    if (renderCount == 0) {\n      return displayStoredData();\n    }\n  }, [allTags]);\n\n  const displayStoredData = () => {\n    // call function to get data from returned props from firebase\n    getStoredData().then(res => {\n      console.log(res[0]); // set state\n\n      let userStored;\n\n      if (!res[1].addedHospTags) {\n        userStored = \"\";\n      } else {\n        if (!res[1].addedHospTags[props.targetHos.HospitalName.replace(/\\s/g, '')]) {\n          userStored = \"\";\n        } else {\n          userStored = res[1].addedHospTags[props.targetHos.HospitalName.replace(/\\s/g, '')];\n        }\n      }\n\n      setState({\n        currentTags: res[0].data.tags ? res[0].data.tags : \"\",\n        storedUserTags: userStored\n      }); // update renderCount to 1 to stop react from making any more useEffect call\n\n      setRenderCount(1);\n    }).catch(error => {\n      console.error(error);\n    });\n  }; // wait for returned props from firebase to be ready\n\n\n  let getStoredData = async () => {\n    let [storedSearchInfo, userStoredCredentials] = await Promise.all([axios.get(proxyurl + axios.defaults.baseURL + \"getAllSearchDataHospital\", {\n      params: {\n        specialty: props.targetHos.relatedSpecialty,\n        hospital: props.targetHos.HospitalName.replace(/\\s+/g, \"\")\n      }\n    }), props.storedCredentials]);\n    return [storedSearchInfo, userStoredCredentials]; // let storedCredentials = await props.storedCredentials;\n    // return storedCredentials;\n  };\n\n  const [open, setOpen] = React.useState(false);\n\n  const handleClickOpen = () => {\n    setOpen(true);\n  };\n\n  const handleClose = value => {\n    setOpen(false);\n  }; // add or remove hospital review tags: make changes to both the current hospital and user stored tags\n\n\n  const addRemoveTag = tag => {\n    let currentTagsCopy = allTags.currentTags; // if currentTagsCopy doesn't exist (no tags have been selected for this hospital before),\n    // assign index -1 (not found)\n\n    let currentTagIndex = currentTagsCopy ? currentTagsCopy.findIndex(eachTag => eachTag.tagName == tag) : -1;\n    let userStoredTagsCopy = allTags.storedUserTags; // if the userStoredTagsCopy doesn't exist (the user has never selected any tags for this\n    // hospital before), assign index -1\n\n    let userStoredTagIndex = userStoredTagsCopy ? userStoredTagsCopy.indexOf(tag) : -1; // if the tag has been selected by user, which means it should also exist\n    // in the database\n\n    if (userStoredTagIndex !== -1) {\n      // remove from user selected tag list in the modal\n      userStoredTagsCopy.splice(userStoredTagIndex, 1); // decrease this tag's count for this hospital in database; this tag should\n      // have already existed in the database since the user selected it\n\n      currentTagsCopy[currentTagIndex].count--;\n\n      if (currentTagsCopy[currentTagIndex].count == 0) {\n        currentTagsCopy.splice(currentTagIndex, 1);\n      }\n\n      setState({\n        currentTags: currentTagsCopy,\n        storedUserTags: userStoredTagsCopy\n      }); // the tag hasn't been selected by the user\n    } else {\n      // if the tag already exists in the database (other users had selected this\n      //  tag for this hospital)\n      if (currentTagIndex !== -1) {\n        // increase the count for this tag in database by 1\n        currentTagsCopy[currentTagIndex].count++;\n        setState(prevState => ({\n          currentTags: currentTagsCopy,\n          // add the new tag to this user's tag list\n          storedUserTags: [...prevState.storedUserTags, tag]\n        })); // the tag doesn't exist in the database; this is the first time a user\n        // selects this tag\n      } else {\n        setState(prevState => ({\n          // if currentTags exist (hospital had users added tags for him before), add the new tag to the list\n          // otherwise (no one had added tags for the hospital before), use the new tag to start the list\n          currentTags: allTags.currentTags ? [...prevState.currentTags, {\n            tagName: tag,\n            count: 1\n          }] : [{\n            tagName: tag,\n            count: 1\n          }],\n          // if the user has selected tags for this hospital before, add the new tag to the list\n          // otherwise, use the new tag to start a list\n          storedUserTags: allTags.storedUserTags ? [...prevState.storedUserTags, tag] : [tag]\n        }));\n      }\n    }\n  }; // create a tag list that contains all tags for this hospital\n\n\n  let tagList = allTags[\"currentTags\"] ? allTags[\"currentTags\"].map(tag => {\n    return /*#__PURE__*/React.createElement(Fragment, {\n      key: tag.tagName,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"li\", {\n      key: tag.tagName,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Chip, {\n      label: tag.tagName + ' (' + tag.count + ')',\n      className: classes.tag,\n      color: \"secondary\",\n      size: \"small\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 11\n      }\n    })));\n  }) : \"\"; // predefined tags in edit tags diagolue\n\n  const predefinedTags = [\"Clean\", \"Customer Service\", \"Modern\", \"Organized\", \"Reliable\", \"Spacious\", \"Welcoming\", \"Well-equipped\"];\n  let predefinedTagList = predefinedTags.map(tag => {\n    let selected; // if the user has selected any tags for this hospital before\n\n    if (allTags.storedUserTags) {\n      // if the tag exists in the user selected tag list\n      if (allTags.storedUserTags.includes(tag)) {\n        selected = true;\n      } else {\n        selected = false;\n      } // all tags have never been selected before by the user\n\n    } else {\n      selected = false;\n    }\n\n    return /*#__PURE__*/React.createElement(Fragment, {\n      key: tag,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 266,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(PreDefinedTag, {\n      key: tag,\n      label: tag,\n      selected: selected,\n      addRemoveTag: addRemoveTag,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 9\n      }\n    }));\n  });\n\n  const updateSelectedTags = () => {\n    const hospitalNewTags = {\n      hospital: props.targetHos.HospitalName,\n      tags: allTags[\"storedUserTags\"]\n    };\n    props.updateUserStoredHospTags(hospitalNewTags);\n    const updateInfo = {\n      specialty: props.targetHos.RelateSpecialty,\n      hospital: props.targetHos.HospitalName,\n      tags: allTags[\"currentTags\"]\n    };\n    props.updateHospTags(updateInfo);\n    setOpen(false);\n  };\n\n  if (renderCount == 0) {\n    // loading spinner if prop data is not yet available\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 294,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(CircularProgress, {\n      color: \"secondary\",\n      style: {\n        marginLeft: '45%',\n        marginTop: '5%'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 295,\n        columnNumber: 9\n      }\n    }));\n  } else {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 303,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Hidden, {\n      smUp: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 304,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"hr\", {\n      className: classes.line,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 305,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(Box, {\n      mt: 2,\n      mb: 2,\n      display: \"flex\",\n      flexDirection: \"column\",\n      className: classes.reviewTagsBox,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 306,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Typography, {\n      variant: \"h6\",\n      color: \"primary\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 313,\n        columnNumber: 13\n      }\n    }, \"Review Tags\"), /*#__PURE__*/React.createElement(Divider, {\n      className: classes.divider,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 316,\n        columnNumber: 13\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.tagDialog,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 9\n      }\n    }, tagList, \" \", authenticated ? /*#__PURE__*/React.createElement(Button, {\n      color: \"primary\",\n      startIcon: /*#__PURE__*/React.createElement(EditOutlinedIcon, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 326,\n          columnNumber: 26\n        }\n      }),\n      onClick: handleClickOpen,\n      style: {\n        textTransform: \"none\"\n      },\n      className: classes.editTagsButton,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 324,\n        columnNumber: 13\n      }\n    }, \"Edit Tags\") :\n    /*#__PURE__*/\n    // michelle 5/16: 这边原来是“”  现在用下面的button替换掉\n    React.createElement(Button, {\n      color: \"primary\",\n      startIcon: /*#__PURE__*/React.createElement(EditOutlinedIcon, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 337,\n          columnNumber: 28\n        }\n      }),\n      onClick: () => props.handleLoginOpen(\"Tag\"),\n      style: {\n        textTransform: \"none\"\n      },\n      className: classes.editTagsButton,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 335,\n        columnNumber: 15\n      }\n    }, \"Edit Tags\")), /*#__PURE__*/React.createElement(Dialog, {\n      onClose: handleClose,\n      open: open,\n      maxWidth: \"xs\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 347,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Typography, {\n      variant: \"Body\",\n      style: {\n        margin: 20\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 348,\n        columnNumber: 11\n      }\n    }, \"Please select tag(s) that best describe this hospital from the list below:\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.editTagDialog,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 353,\n        columnNumber: 11\n      }\n    }, predefinedTagList), /*#__PURE__*/React.createElement(DialogActions, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 358,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      onClick: updateSelectedTags,\n      variant: \"outlined\",\n      color: \"primary\",\n      style: {\n        textTransform: \"none\",\n        margin: 10\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 359,\n        columnNumber: 13\n      }\n    }, \"Done\"))));\n  }\n}\n\nfunction PreDefinedTag(props) {\n  const classes = useStyles();\n  const [selected, selectUnselectTag] = React.useState(props.selected);\n\n  const handleClick = () => {\n    selectUnselectTag(!selected);\n    props.addRemoveTag(props.label);\n  };\n\n  return /*#__PURE__*/React.createElement(\"li\", {\n    key: props.key,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 385,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Chip, {\n    label: props.label,\n    className: classes.tag,\n    color: \"secondary\",\n    variant: selected ? \"default\" : \"secondary\",\n    onClick: handleClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 386,\n      columnNumber: 7\n    }\n  }));\n}\n\nHospTags.propTypes = {\n  updateUserStoredHospTags: PropTypes.func.isRequired\n};\n\nconst mapStateToProps = state => ({\n  authenticated: state.user.authenticated,\n  storedCredentials: state.user.credentials,\n  // a hospital's information from firebase\n  searchInfo: state.data.searchInfoHospital\n});\n\nconst mapActionsToProps = {\n  updateUserStoredHospTags,\n  updateHospTags\n};\nexport default connect(mapStateToProps, mapActionsToProps)(HospTags);","map":{"version":3,"sources":["/Users/Michelle/Desktop/Capstone/CapstoneEclipseAB11/src/Components/profile/HospTags.js"],"names":["React","Fragment","useEffect","makeStyles","Dialog","Chip","Button","Box","Typography","DialogActions","Hidden","Divider","EditOutlinedIcon","CircularProgress","connect","PropTypes","axios","updateUserStoredHospTags","updateHospTags","proxyurl","useStyles","theme","editTagDialog","display","justifyContent","flexWrap","listStyle","padding","spacing","margin","tag","tagDialog","breakpoints","down","marginLeft","marginBottom","editTagsButton","line","border","reviewTagsBox","alignItems","divider","height","width","backgroundColor","HospTags","props","classes","authenticated","allTags","setState","useState","currentTags","storedUserTags","renderCount","setRenderCount","displayStoredData","getStoredData","then","res","console","log","userStored","addedHospTags","targetHos","HospitalName","replace","data","tags","catch","error","storedSearchInfo","userStoredCredentials","Promise","all","get","defaults","baseURL","params","specialty","relatedSpecialty","hospital","storedCredentials","open","setOpen","handleClickOpen","handleClose","value","addRemoveTag","currentTagsCopy","currentTagIndex","findIndex","eachTag","tagName","userStoredTagsCopy","userStoredTagIndex","indexOf","splice","count","prevState","tagList","map","predefinedTags","predefinedTagList","selected","includes","updateSelectedTags","hospitalNewTags","updateInfo","RelateSpecialty","marginTop","textTransform","handleLoginOpen","PreDefinedTag","selectUnselectTag","handleClick","label","key","propTypes","func","isRequired","mapStateToProps","state","user","credentials","searchInfo","searchInfoHospital","mapActionsToProps"],"mappings":"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","sourcesContent":["import React, { Fragment, useEffect } from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\n\nimport Dialog from \"@material-ui/core/Dialog\";\nimport Chip from \"@material-ui/core/Chip\";\nimport Button from \"@material-ui/core/Button\";\nimport Box from \"@material-ui/core/Box\";\nimport Typography from \"@material-ui/core/Typography\";\nimport DialogActions from \"@material-ui/core/DialogActions\";\nimport Hidden from \"@material-ui/core/Hidden\";\nimport Divider from \"@material-ui/core/Divider\";\nimport EditOutlinedIcon from \"@material-ui/icons/EditOutlined\";\nimport CircularProgress from '@material-ui/core/CircularProgress';\n\nimport { connect } from \"react-redux\";\nimport PropTypes from \"prop-types\";\nimport axios from \"axios\";\n\n\nimport { updateUserStoredHospTags } from \"../../redux/actions/userActions\";\nimport { updateHospTags } from \"../../redux/actions/dataActions\";\n\nconst proxyurl = \"https://cors-anywhere.herokuapp.com/\";\n\n\n// ～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～\n// ～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～\n// \"hospital tags\" used in this js is actually referred to the tags attached to a specialty in this hospital\n// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nconst useStyles = makeStyles((theme) => ({\n  editTagDialog: {\n    display: \"flex\",\n    justifyContent: \"center\",\n    flexWrap: \"wrap\",\n    listStyle: \"none\",\n    padding: theme.spacing(0.5),\n    margin: 0,\n  },\n\n  tag: {\n    margin: theme.spacing(0.5),\n  },\n\n  tagDialog: {\n    display: \"flex\",\n    flexWrap: \"wrap\",\n    listStyle: \"none\",\n    padding: theme.spacing(0.5),\n    margin: 0,\n    [theme.breakpoints.down(\"xs\")]: {\n      marginLeft: 10,\n    },\n    marginBottom: 20,\n  },\n\n  editTagsButton: {\n    [theme.breakpoints.down(\"xs\")]: {\n      marginLeft: 20,\n    },\n  },\n\n  line: {\n    [theme.breakpoints.down(\"xs\")]: {\n      border: \"5px solid rgba(0, 0, 0, 0.05)\",\n    },\n  },\n\n  reviewTagsBox: {\n    [theme.breakpoints.down(\"xs\")]: {\n      justifyContent: \"left\",\n      alignItems: \"left\",\n      marginLeft: 20,\n    },\n  },\n\n  divider: {\n    height: 2,\n    width: 115,\n    backgroundColor: \"#FF8686\",\n  },\n}));\n\n// Edit Hospital Tags (用在HospInfo.js)\n// 目前hospital所有的tags and edit tags 都是hardcoded， 麻烦你了\nfunction HospTags(props) {\n  const classes = useStyles();\n  const authenticated = props.authenticated;\n\n  const [allTags, setState] = React.useState({\n    currentTags: [],\n    storedUserTags: []\n  })\n\n  const [renderCount, setRenderCount] = React.useState(0);\n\n  // only call useEffect if renderCount = 0 (will be updated to 1 if stored data\n  // in firebase is successfully set to state)\n  useEffect(() => {\n    if (renderCount == 0) {\n      return displayStoredData();\n    }\n  }, [allTags]);\n\n  const displayStoredData = () => {\n    // call function to get data from returned props from firebase\n    getStoredData()\n      .then((res) => {\n        console.log(res[0])\n        // set state\n        let userStored;\n        if (!res[1].addedHospTags) {\n          userStored = \"\";\n        } else {\n          if (!res[1].addedHospTags[props.targetHos.HospitalName.replace(/\\s/g,'')]) {\n            userStored = \"\";\n          } else {\n            userStored = res[1].addedHospTags[props.targetHos.HospitalName.replace(/\\s/g,'')];\n          }\n        }\n        setState({\n          currentTags: res[0].data.tags ? res[0].data.tags : \"\",\n          storedUserTags: userStored\n        })\n        // update renderCount to 1 to stop react from making any more useEffect call\n        setRenderCount(1);\n      }).catch((error) => {\n        console.error(error);\n      })\n  }\n\n  // wait for returned props from firebase to be ready\n  let getStoredData = async () => {\n    let [storedSearchInfo, userStoredCredentials] =\n      await Promise.all([axios.get(proxyurl + axios.defaults.baseURL + \"getAllSearchDataHospital\",\n      {\n        params: {\n          specialty: props.targetHos.relatedSpecialty,\n          hospital: props.targetHos.HospitalName.replace(/\\s+/g, \"\"),\n        }\n      }), props.storedCredentials]);\n    return [storedSearchInfo, userStoredCredentials];\n    // let storedCredentials = await props.storedCredentials;\n    // return storedCredentials;\n  }\n\n  const [open, setOpen] = React.useState(false);\n\n  const handleClickOpen = () => {\n    setOpen(true);\n  };\n\n  const handleClose = (value) => {\n    setOpen(false);\n  };\n\n\n\n\n  // add or remove hospital review tags: make changes to both the current hospital and user stored tags\n  const addRemoveTag = (tag) => {\n    let currentTagsCopy = allTags.currentTags;\n    // if currentTagsCopy doesn't exist (no tags have been selected for this hospital before),\n    // assign index -1 (not found)\n    let currentTagIndex = currentTagsCopy ? currentTagsCopy.findIndex(eachTag => eachTag.tagName == tag) : -1;\n\n    let userStoredTagsCopy = allTags.storedUserTags;\n    // if the userStoredTagsCopy doesn't exist (the user has never selected any tags for this\n    // hospital before), assign index -1\n    let userStoredTagIndex = userStoredTagsCopy ? userStoredTagsCopy.indexOf(tag) : -1;\n\n    // if the tag has been selected by user, which means it should also exist\n    // in the database\n    if (userStoredTagIndex !== -1) {\n      // remove from user selected tag list in the modal\n      userStoredTagsCopy.splice(userStoredTagIndex, 1);\n      // decrease this tag's count for this hospital in database; this tag should\n      // have already existed in the database since the user selected it\n      currentTagsCopy[currentTagIndex].count--;\n      if (currentTagsCopy[currentTagIndex].count == 0) {\n        currentTagsCopy.splice(currentTagIndex, 1);\n      }\n      setState({\n        currentTags: currentTagsCopy,\n        storedUserTags: userStoredTagsCopy\n      })\n      // the tag hasn't been selected by the user\n    } else {\n      // if the tag already exists in the database (other users had selected this\n      //  tag for this hospital)\n      if (currentTagIndex !== -1) {\n        // increase the count for this tag in database by 1\n        currentTagsCopy[currentTagIndex].count++;\n\n        setState(prevState => ({\n          currentTags: currentTagsCopy,\n          // add the new tag to this user's tag list\n          storedUserTags: [\n            ...prevState.storedUserTags, tag\n          ]\n        }))\n        // the tag doesn't exist in the database; this is the first time a user\n        // selects this tag\n      } else {\n        setState(prevState => ({\n          // if currentTags exist (hospital had users added tags for him before), add the new tag to the list\n          // otherwise (no one had added tags for the hospital before), use the new tag to start the list\n          currentTags: allTags.currentTags ? [\n            ...prevState.currentTags, { tagName: tag, count: 1 }\n          ] : [{ tagName: tag, count: 1 }],\n          // if the user has selected tags for this hospital before, add the new tag to the list\n          // otherwise, use the new tag to start a list\n          storedUserTags: allTags.storedUserTags ? [\n            ...prevState.storedUserTags, tag\n          ] : [tag]\n        }))\n      }\n    }\n  }\n\n\n  // create a tag list that contains all tags for this hospital\n  let tagList = (allTags[\"currentTags\"]) ? allTags[\"currentTags\"].map(tag => {\n    return (\n      <Fragment key={tag.tagName}>\n        <li key={tag.tagName}>\n          <Chip\n            label={tag.tagName + ' (' + tag.count + ')'}\n            className={classes.tag}\n            color=\"secondary\"\n            size=\"small\"\n          />\n        </li>\n      </Fragment>\n    )\n  }) : \"\";\n\n\n  // predefined tags in edit tags diagolue\n  const predefinedTags = [\n    \"Clean\",\n    \"Customer Service\",\n    \"Modern\",\n    \"Organized\",\n    \"Reliable\",\n    \"Spacious\",\n    \"Welcoming\",\n    \"Well-equipped\"\n  ];\n\n  let predefinedTagList = predefinedTags.map(tag => {\n    let selected;\n    // if the user has selected any tags for this hospital before\n    if (allTags.storedUserTags) {\n      // if the tag exists in the user selected tag list\n      if (allTags.storedUserTags.includes(tag)) {\n        selected = true;\n      } else {\n        selected = false;\n      }\n      // all tags have never been selected before by the user\n    } else {\n      selected = false;\n    }\n    return (\n      <Fragment key={tag}>\n        <PreDefinedTag key={tag} label={tag} selected={selected} addRemoveTag={addRemoveTag} />\n      </Fragment>\n    )\n  });\n\n  const updateSelectedTags = () => {\n    const hospitalNewTags = {\n      hospital: props.targetHos.HospitalName,\n      tags: allTags[\"storedUserTags\"],\n    };\n    props.updateUserStoredHospTags(hospitalNewTags);\n\n    \n    const updateInfo = {\n      specialty: props.targetHos.RelateSpecialty,\n      hospital: props.targetHos.HospitalName,\n      tags: allTags[\"currentTags\"]\n    }\n    props.updateHospTags(updateInfo);\n    setOpen(false);\n  }\n\n\n\n  if (renderCount == 0) {\n    // loading spinner if prop data is not yet available\n    return (\n      <div>\n        <CircularProgress color=\"secondary\" style={{ marginLeft: '45%', marginTop: '5%' }} />\n      </div>\n    );\n\n  } else {\n\n\n    return (\n      <div>\n        <Hidden smUp>\n          <hr className={classes.line}></hr>\n          <Box\n            mt={2}\n            mb={2}\n            display=\"flex\"\n            flexDirection=\"column\"\n            className={classes.reviewTagsBox}\n          >\n            <Typography variant=\"h6\" color=\"primary\">\n              Review Tags\n          </Typography>\n            <Divider className={classes.divider} />\n          </Box>\n        </Hidden>\n        {/* 显示这个hospital现在有的tags, 目前是hardcoded的， 麻烦你了 */}\n        <div className={classes.tagDialog}>\n          {tagList}{\" \"}\n          {/* 如果登入了，edit tags的button会出现，否则不会出现 */}\n          {authenticated ? (\n            <Button\n              color=\"primary\"\n              startIcon={<EditOutlinedIcon />}\n              onClick={handleClickOpen}\n              style={{ textTransform: \"none\" }}\n              className={classes.editTagsButton}\n            >\n              Edit Tags\n          </Button>\n          ) : (\n              // michelle 5/16: 这边原来是“”  现在用下面的button替换掉\n              <Button\n                color=\"primary\"\n                startIcon={<EditOutlinedIcon />}\n                onClick={() => props.handleLoginOpen(\"Tag\")}\n                style={{ textTransform: \"none\" }}\n                className={classes.editTagsButton}\n              >\n                Edit Tags\n             </Button>\n            )}\n        </div>\n\n        <Dialog onClose={handleClose} open={open} maxWidth=\"xs\">\n          <Typography variant=\"Body\" style={{ margin: 20 }}>\n            Please select tag(s) that best describe this hospital from the list\n            below:\n        </Typography>\n          {/* 弹窗出现所有tags选项 */}\n          <div className={classes.editTagDialog}>\n            {predefinedTagList}\n          </div>\n\n          {/* Done button， 目前是点了就关掉窗口，没有save user点了什么 */}\n          <DialogActions>\n            <Button\n              onClick={updateSelectedTags}\n              variant=\"outlined\"\n              color=\"primary\"\n              style={{ textTransform: \"none\", margin: 10 }}\n            >\n              Done\n          </Button>\n          </DialogActions>\n        </Dialog>\n      </div>\n    );\n  }\n}\n\nfunction PreDefinedTag(props) {\n  const classes = useStyles();\n\n  const [selected, selectUnselectTag] = React.useState(props.selected);\n\n  const handleClick = () => {\n    selectUnselectTag(!selected);\n    props.addRemoveTag(props.label);\n  };\n\n  return (\n    <li key={props.key}>\n      <Chip\n        label={props.label}\n        className={classes.tag}\n        color=\"secondary\"\n        variant={selected ? \"default\" : \"secondary\"}\n        onClick={handleClick}\n      />\n    </li>\n  )\n}\n\n\n\n\nHospTags.propTypes = {\n  updateUserStoredHospTags: PropTypes.func.isRequired,\n};\n\nconst mapStateToProps = (state) => ({\n  authenticated: state.user.authenticated,\n  storedCredentials: state.user.credentials,\n  // a hospital's information from firebase\n  searchInfo: state.data.searchInfoHospital\n});\n\nconst mapActionsToProps = {\n  updateUserStoredHospTags,\n  updateHospTags\n};\n\nexport default connect(mapStateToProps, mapActionsToProps)(HospTags);"]},"metadata":{},"sourceType":"module"}